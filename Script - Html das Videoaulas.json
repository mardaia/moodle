{"files":[{"id":"5957f362-b4e6-486b-a5b0-904f71af776a","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"America/Manaus\",\n  \"dependencies\": {\n    \"enabledAdvancedServices\": [\n      {\n        \"userSymbol\": \"YouTube\",\n        \"version\": \"v3\",\n        \"serviceId\": \"youtube\"\n      }\n    ]\n  },\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\"\n}"},{"id":"996f4ea7-0002-4378-a355-020126f56e1b","name":"Código","type":"server_js","source":"function listarVideosComPlaylists() {\n  try {\n    var pastaId \u003d \u00271SSNB13odd4bWIRXRFoFdFTZVTc1gpira\u0027;\n    if (!pastaId) {\n      throw new Error(\u0027O ID da pasta não foi fornecido.\u0027);\n    }\n\n    var channelId \u003d \u0027UCy4gLST0W8u_DL5Sx4YB76w\u0027; // id do canal do youtube\n    var videoList \u003d [];\n\n    var playlists \u003d [];\n    var nextPageToken \u003d \u0027\u0027;\n\n    do {\n      var playlistResponse \u003d YouTube.Playlists.list(\u0027id,snippet\u0027, {\n        channelId: channelId,\n        maxResults: 50,\n        pageToken: nextPageToken\n      });\n\n      playlists \u003d playlists.concat(playlistResponse.items);\n      nextPageToken \u003d playlistResponse.nextPageToken;\n    } while (nextPageToken);\n\n    var videoPlaylistMap \u003d {};\n\n    for (var i \u003d 0; i \u003c playlists.length; i++) {\n      var playlist \u003d playlists[i];\n      var playlistId \u003d playlist.id;\n      var playlistTitle \u003d playlist.snippet.title;\n\n      var nextPageTokenVideos \u003d \u0027\u0027;\n      do {\n        var playlistItemsResponse \u003d YouTube.PlaylistItems.list(\u0027snippet\u0027, {\n          playlistId: playlistId,\n          maxResults: 50,\n          pageToken: nextPageTokenVideos\n        });\n\n        var playlistItems \u003d playlistItemsResponse.items;\n        for (var j \u003d 0; j \u003c playlistItems.length; j++) {\n          var videoId \u003d playlistItems[j].snippet.resourceId.videoId;\n          if (!videoPlaylistMap[videoId]) {\n            videoPlaylistMap[videoId] \u003d [];\n          }\n          videoPlaylistMap[videoId].push(playlistTitle);\n        }\n        nextPageTokenVideos \u003d playlistItemsResponse.nextPageToken;\n      } while (nextPageTokenVideos);\n    }\n\n    nextPageToken \u003d \u0027\u0027;\n    do {\n      var response \u003d YouTube.Search.list(\u0027id,snippet\u0027, {\n        channelId: channelId,\n        maxResults: 50,\n        pageToken: nextPageToken,\n        type: \u0027video\u0027\n      });\n\n      var items \u003d response.items;\n\n      for (var k \u003d 0; k \u003c items.length; k++) {\n        var videoId \u003d items[k].id.videoId;\n        var videoUrl \u003d \u0027https://www.youtube.com/watch?v\u003d\u0027 + videoId;\n        var videoTitle \u003d items[k].snippet.title;\n\n        var unidade \u003d \u0027\u0027;\n        var licao \u003d \u0027\u0027;\n        var name \u003d \u0027\u0027;\n\n        var regexLicao \u003d /Unidade\\s+(\\d+)\\s*-\\s*Lição\\s+(\\d+)/i;\n        var regexVisaoGeral \u003d /Visão Geral da Unidade\\s+(\\d+)/i;\n\n        var matchesLicao \u003d videoTitle.match(regexLicao);\n        var matchesVisaoGeral \u003d videoTitle.match(regexVisaoGeral);\n\n        if (matchesLicao) {\n          unidade \u003d matchesLicao[1];\n          licao \u003d matchesLicao[2];\n          name \u003d \u0027Unidade \u0027 + unidade + \u0027 - Lição \u0027 + licao;\n        } else if (matchesVisaoGeral) {\n          unidade \u003d matchesVisaoGeral[1];\n          name \u003d \u0027Visão Geral da Unidade \u0027 + unidade;\n        } else {\n          name \u003d videoTitle;\n        }\n\n        var playlistNames \u003d videoPlaylistMap[videoId] ? videoPlaylistMap[videoId].join(\u0027, \u0027) : \u0027\u0027;\n\n        videoList.push({\n          id: videoId,\n          url: videoUrl,\n          playlist: playlistNames,\n          name: name\n        });\n      }\n\n      nextPageToken \u003d response.nextPageToken;\n    } while (nextPageToken);\n\n    var pastaDestino \u003d DriveApp.getFolderById(pastaId);\n    if (!pastaDestino) {\n      throw new Error(\u0027A pasta com o ID fornecido não foi encontrada.\u0027);\n    }\n\n    var planilha \u003d SpreadsheetApp.create(\u0027Relatório de Vídeos do Canal\u0027);\n    var arquivoPlanilha \u003d DriveApp.getFileById(planilha.getId());\n    pastaDestino.addFile(arquivoPlanilha);\n    DriveApp.getRootFolder().removeFile(arquivoPlanilha);\n\n    var sheet \u003d planilha.getActiveSheet();\n    var linha \u003d 1;\n\n    sheet.clear();\n    sheet.getRange(linha, 1).setValue(\u0027ID do Vídeo\u0027);\n    sheet.getRange(linha, 2).setValue(\u0027URL do Vídeo\u0027);\n    sheet.getRange(linha, 3).setValue(\u0027PlayList\u0027);\n    sheet.getRange(linha, 4).setValue(\u0027NAME\u0027);\n    linha++;\n\n    for (var m \u003d 0; m \u003c videoList.length; m++) {\n      var video \u003d videoList[m];\n      sheet.getRange(linha, 1).setValue(video.id);\n      sheet.getRange(linha, 2).setValue(video.url);\n      sheet.getRange(linha, 3).setValue(video.playlist);\n      sheet.getRange(linha, 4).setValue(video.name);\n      linha++;\n    }\n\n    Logger.log(\u0027Planilha criada com sucesso na pasta de destino!\u0027);\n\n  } catch (e) {\n    Logger.log(\u0027Erro: \u0027 + e.message);\n  }\n}\n\n\nfunction criarPaginaHtmlDeVideosPorPlaylist() {\n  try {\n    var pastaPlanilhasId \u003d \u00271SSNB13odd4bWIRXRFoFdFTZVTc1gpira\u0027;\n    var pastaTranscricoesId \u003d \u00271pMSVXPUkspITWbDA0tl23gSbh3fjeWcX\u0027; // nova pasta com PDFs\n    var nomePlaylist \u003d \u0027Tomada de Decisão Estratégica para Líderes\u0027;\n\n    var pastaPlanilhas \u003d DriveApp.getFolderById(pastaPlanilhasId);\n    var arquivosPlanilha \u003d pastaPlanilhas.getFilesByType(MimeType.GOOGLE_SHEETS);\n    if (!arquivosPlanilha.hasNext()) {\n      throw new Error(\u0027Nenhuma planilha encontrada na pasta de planilhas.\u0027);\n    }\n    var planilha \u003d arquivosPlanilha.next();\n    var sheet \u003d SpreadsheetApp.open(planilha).getActiveSheet();\n    var dadosPlanilha \u003d sheet.getDataRange().getValues();\n\n    // Ler PDFs\n    var pastaTranscricoes \u003d DriveApp.getFolderById(pastaTranscricoesId);\n    var arquivosPdf \u003d pastaTranscricoes.getFiles();\n    var mapaTranscricoes \u003d [];\n    while (arquivosPdf.hasNext()) {\n      var file \u003d arquivosPdf.next();\n      if (file.getName().toLowerCase().endsWith(\u0027.pdf\u0027)) {\n        var fileId \u003d file.getId();\n        var baseName \u003d file.getName().replace(/\\.pdf$/i, \u0027\u0027);\n        var webViewLink \u003d \"https://drive.google.com/file/d/\" + fileId + \"/view?usp\u003dsharing\";\n        // Vamos guardar cada PDF por seu nome completo\n        mapaTranscricoes.push({nome: baseName, link: webViewLink});\n      }\n    }\n\n    var videosPorPlaylist \u003d [];\n    for (var i \u003d 1; i \u003c dadosPlanilha.length; i++) {\n      var playlistName \u003d dadosPlanilha[i][2];\n      if (playlistName \u0026\u0026 playlistName.toLowerCase().includes(nomePlaylist.toLowerCase())) {\n        videosPorPlaylist.push({\n          unidadeLicao: dadosPlanilha[i][3] || \u0027Sem Unidade/Lição\u0027,\n          url: dadosPlanilha[i][1]\n        });\n      }\n    }\n\n    if (videosPorPlaylist.length \u003d\u003d\u003d 0) {\n      throw new Error(\u0027Nenhum vídeo encontrado para a playlist especificada.\u0027);\n    }\n\n    var videosUnicos \u003d [];\n    var urlsEncontradas \u003d new Set();\n    videosPorPlaylist.forEach(function (video) {\n      if (!urlsEncontradas.has(video.url)) {\n        urlsEncontradas.add(video.url);\n        videosUnicos.push(video);\n      }\n    });\n\n    var mapaVideos \u003d {};\n    videosUnicos.forEach(function (video) {\n      var unidadeLicao \u003d video.unidadeLicao;\n      if (!mapaVideos[unidadeLicao]) {\n        mapaVideos[unidadeLicao] \u003d [];\n      }\n\n      // Tentar encontrar um PDF cujo nome comece com o `unidadeLicao`\n      var pdfLink \u003d \u0027\u0027;\n      for (var p \u003d 0; p \u003c mapaTranscricoes.length; p++) {\n        if (mapaTranscricoes[p].nome.toLowerCase().indexOf(unidadeLicao.toLowerCase()) \u003d\u003d\u003d 0) {\n          pdfLink \u003d mapaTranscricoes[p].link;\n          break;\n        }\n      }\n\n      mapaVideos[unidadeLicao].push({url: video.url, pdf: pdfLink});\n    });\n\n    // Ordenação\n    var ordemVideos \u003d Object.keys(mapaVideos).sort((a, b) \u003d\u003e {\n      var regex \u003d /Unidade (\\d+)(?: - Lição (\\d+))?/i;\n      var matchA \u003d regex.exec(a);\n      var matchB \u003d regex.exec(b);\n\n      if (matchA \u0026\u0026 matchB) {\n        var unidadeA \u003d parseInt(matchA[1], 10);\n        var unidadeB \u003d parseInt(matchB[1], 10);\n\n        if (unidadeA \u003d\u003d\u003d unidadeB) {\n          var licaoA \u003d matchA[2] ? parseInt(matchA[2], 10) : -1; \n          var licaoB \u003d matchB[2] ? parseInt(matchB[2], 10) : -1;\n          return licaoA - licaoB;\n        }\n        return unidadeA - unidadeB;\n      }\n      return a.localeCompare(b);\n    });\n\n    // Recria a estrutura\n    var estrutura \u003d {};\n    ordemVideos.forEach(function (unidadeLicao) {\n      var regexLicao \u003d /Unidade\\s+(\\d+)\\s*-\\s*Lição\\s+(\\d+)/i;\n      var regexVisaoGeral \u003d /Visão Geral da Unidade\\s+(\\d+)/i;\n\n      var matchesLicao \u003d unidadeLicao.match(regexLicao);\n      var matchesVisaoGeral \u003d unidadeLicao.match(regexVisaoGeral);\n\n      if (matchesLicao) {\n        var uni \u003d matchesLicao[1];\n        var lic \u003d matchesLicao[2];\n        if (!estrutura[uni]) estrutura[uni] \u003d {};\n        estrutura[uni][lic] \u003d mapaVideos[unidadeLicao];\n      } else if (matchesVisaoGeral) {\n        var uni \u003d matchesVisaoGeral[1];\n        if (!estrutura[uni]) estrutura[uni] \u003d {};\n        estrutura[uni][\u0027visao\u0027] \u003d mapaVideos[unidadeLicao];\n      }\n    });\n\n    var htmlConteudo \u003d \u0027\u003c!DOCTYPE html\u003e\\n\u003chtml lang\u003d\"pt-BR\"\u003e\\n\u003chead\u003e\\n\u003cmeta charset\u003d\"UTF-8\"\u003e\\n\u0027;\n    htmlConteudo +\u003d \u0027\u003ctitle\u003eTomada de Decisão\u003c/title\u003e\\n\u003cstyle\u003e\\n\u0027;\n    htmlConteudo +\u003d `\n    body {\n      margin: 0; \n      padding: 0;\n      font-family: \u0027Poppins\u0027, sans-serif; \n      background-color: #f0f0f5; \n      color: #333;\n      display: flex; \n      height: 100vh;\n    }\n\n    .sidebar {\n      width: 320px;\n      background: #1F4E79;\n      color: #ffffff;\n      overflow-y: auto;\n      padding-top: 20px;\n      box-sizing: border-box;\n    }\n\n    .content {\n      flex: 1; \n      background: #ffffff;\n      padding: 20px;\n      box-sizing: border-box;\n      overflow-y: auto;\n    }\n\n    h1.title {\n      text-align: center; \n      color: #1F4E79;\n      margin-bottom: 20px;\n    }\n\n    nav {\n      width: 100%;\n    }\n\n    nav ul {\n      list-style-type: none;\n      padding: 0;\n      margin: 0;\n    }\n\n    nav li {\n      border-bottom: 1px solid rgba(255,255,255,0.2);\n      padding: 10px 20px;\n      cursor: pointer;\n      background: none;\n      color: #ffffff;\n      position: relative;\n    }\n\n    nav li:hover {\n      background: #2b6da6;\n    }\n\n    nav li h3 {\n      margin: 0;\n      font-size: 1em;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n\n    nav ul ul {\n      display: none;\n      padding-left: 20px;\n      background: #17415f;\n      margin-top: 10px;\n    }\n\n    nav ul ul li {\n      border: none;\n      padding: 10px 10px;\n      cursor: pointer;\n      background: none;\n      color: #ffffff;\n      font-size: 0.95em;\n    }\n\n    nav ul ul li:hover {\n      background: #26628b;\n    }\n\n    .toggle::after {\n      content: \"▸\";\n      font-size: 0.8em;\n      margin-left: 10px;\n    }\n\n    .open \u003e h3 \u003e .toggle::after {\n      content: \"▾\";\n    }\n\n    .video-item {\n      margin-bottom: 20px;\n      text-align: center;\n    }\n\n    iframe {\n      max-width: 100%;\n    }\n\n    .transcricao-btn {\n      display: inline-block;\n      margin-top: 10px;\n      padding: 8px 15px;\n      font-size: 0.9em;\n      background: #1F4E79;\n      color: #fff;\n      border: none;\n      text-decoration: none;\n      border-radius: 5px;\n      cursor: pointer;\n    }\n\n    .transcricao-btn:hover {\n      background: #2b6da6;\n    }\n    `;\n\n    htmlConteudo +\u003d \u0027\u003c/style\u003e\\n\u003c/head\u003e\\n\u003cbody\u003e\\n\u0027;\n\n    htmlConteudo +\u003d `\n    \u003cdiv class\u003d\"sidebar\"\u003e\n      \u003cnav\u003e\n        \u003cul\u003e\n    `;\n\n    var todosVideos \u003d [];\n\n    Object.keys(estrutura).sort((a,b)\u003d\u003e a - b).forEach(function(unidade) {\n      htmlConteudo +\u003d `\u003cli class\u003d\"has-submenu\"\u003e\u003ch3\u003e\u003cspan\u003eUnidade ${unidade}\u003c/span\u003e\u003cspan class\u003d\"toggle\"\u003e\u003c/span\u003e\u003c/h3\u003e\\n\u003cul\u003e\\n`;\n\n      if (estrutura[unidade][\u0027visao\u0027]) {\n        var idVisao \u003d \u0027unidade\u0027+unidade+\u0027-visao\u0027;\n        var videosVisao \u003d estrutura[unidade][\u0027visao\u0027].map(function(obj){\n          var videoEmbedUrl \u003d obj.url.replace(\u0027watch?v\u003d\u0027, \u0027embed/\u0027);\n          var pdfLink \u003d obj.pdf;\n          return `\u003cdiv class\u003d\"video-item\"\u003e\n                    \u003ciframe width\u003d\"560\" height\u003d\"315\" src\u003d\"${videoEmbedUrl}\" frameborder\u003d\"0\" allowfullscreen\u003e\u003c/iframe\u003e\u003cbr\u003e\n                    ${pdfLink ? `\u003cbr\u003e\u003cdiv style\u003d\"margin-top:10px;\"\u003e\u003ca class\u003d\"transcricao-btn\" href\u003d\"${pdfLink}\" target\u003d\"_blank\"\u003eVer Transcrição\u003c/a\u003e\u003c/div\u003e` : \u0027\u0027}\n                  \u003c/div\u003e`;\n        }).join(\u0027\\n\u0027);\n\n        todosVideos.push({id: idVisao, html: videosVisao});\n        htmlConteudo +\u003d `\u003cli class\u003d\"has-submenu\"\u003e\u003ch3\u003e\u003cspan\u003eVisão Geral da Unidade ${unidade}\u003c/span\u003e\u003cspan class\u003d\"toggle\"\u003e\u003c/span\u003e\u003c/h3\u003e\u003cul id\u003d\"${idVisao}\"\u003e\u003c/ul\u003e\u003c/li\u003e\\n`;\n      }\n\n      var licoes \u003d Object.keys(estrutura[unidade]).filter(x \u003d\u003e x !\u003d\u003d \u0027visao\u0027).map(n\u003d\u003eparseInt(n)).sort((a,b)\u003d\u003ea-b);\n      licoes.forEach(function(licao) {\n        var idLicao \u003d \u0027unidade\u0027+unidade+\u0027-licao\u0027+licao;\n        var videosLicao \u003d estrutura[unidade][licao].map(function(obj){\n          var videoEmbedUrl \u003d obj.url.replace(\u0027watch?v\u003d\u0027, \u0027embed/\u0027);\n          var pdfLink \u003d obj.pdf;\n          return `\u003cdiv class\u003d\"video-item\"\u003e\n                    \u003ciframe width\u003d\"560\" height\u003d\"315\" src\u003d\"${videoEmbedUrl}\" frameborder\u003d\"0\" allowfullscreen\u003e\u003c/iframe\u003e\n                    ${pdfLink ? `\u003cbr\u003e\u003ca class\u003d\"transcricao-btn\" href\u003d\"${pdfLink}\" target\u003d\"_blank\"\u003eVer Transcrição\u003c/a\u003e` : \u0027\u0027}\n                  \u003c/div\u003e`;\n        }).join(\u0027\\n\u0027);\n\n        todosVideos.push({id: idLicao, html: videosLicao});\n        htmlConteudo +\u003d `\u003cli class\u003d\"has-submenu\"\u003e\u003ch3\u003e\u003cspan\u003eLição ${licao}\u003c/span\u003e\u003cspan class\u003d\"toggle\"\u003e\u003c/span\u003e\u003c/h3\u003e\u003cul id\u003d\"${idLicao}\"\u003e\u003c/ul\u003e\u003c/li\u003e\\n`;\n      });\n\n      htmlConteudo +\u003d \u0027\u003c/ul\u003e\\n\u003c/li\u003e\\n\u0027;\n    });\n\n    htmlConteudo +\u003d `\n        \u003c/ul\u003e\n      \u003c/nav\u003e\n    \u003c/div\u003e\n    \u003cdiv class\u003d\"content\"\u003e\n      \u003ch1 class\u003d\"title\"\u003eTomada de Decisão\u003c/h1\u003e\n      \u003cdiv id\u003d\"video-container\"\u003e\u003c/div\u003e\n    \u003c/div\u003e\n    `;\n\n    htmlConteudo +\u003d `\n    \u003cscript\u003e\n      document.querySelectorAll(\u0027.has-submenu \u003e h3\u0027).forEach(function(trigger) {\n          trigger.addEventListener(\u0027click\u0027, function(e) {\n              e.stopPropagation();\n              var parent \u003d this.parentElement;\n              parent.classList.toggle(\u0027open\u0027);\n              var submenu \u003d parent.querySelector(\u0027ul\u0027);\n              if (submenu) {\n                  if (parent.classList.contains(\u0027open\u0027)) {\n                      submenu.style.display \u003d \u0027block\u0027;\n                  } else {\n                      submenu.style.display \u003d \u0027none\u0027;\n                  }\n              }\n          });\n      });\n\n      document.querySelectorAll(\u0027.has-submenu ul li.has-submenu \u003e h3\u0027).forEach(function(el) {\n        el.addEventListener(\u0027click\u0027, function(event) {\n          event.stopPropagation();\n          var parent \u003d this.parentElement;\n          var ul \u003d parent.querySelector(\u0027ul\u0027);\n          if(ul \u0026\u0026 ul.id) {\n            var videoContainer \u003d document.getElementById(\u0027video-container\u0027);\n            videoContainer.innerHTML \u003d videosData[ul.id] || \u0027\u0027;\n          }\n        });\n      });\n\n      var videosData \u003d {};\n    `;\n\n    todosVideos.forEach(function(item){\n      var contentString \u003d item.html.replace(/`/g, \"\\\\`\");\n      htmlConteudo +\u003d `videosData[\"${item.id}\"] \u003d \\`${contentString}\\`;\\n`;\n    });\n\n    htmlConteudo +\u003d `\n    \u003c/script\u003e\n    `;\n\n    htmlConteudo +\u003d \u0027\u003c/body\u003e\\n\u003c/html\u003e\u0027;\n\n    var arquivoHtml \u003d pastaPlanilhas.createFile(`Ver Videoaulas.html`, htmlConteudo, MimeType.HTML);\n    Logger.log(\u0027Página HTML criada com sucesso: \u0027 + arquivoHtml.getUrl());\n  } catch (e) {\n    Logger.log(\u0027Erro: \u0027 + e.message);\n  }\n}\n"}]}